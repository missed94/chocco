/* 
const arrowLeft = $(".slider__arrow-left-wrapper");
const arrowRight = $(".slider_arrow-right-wrapper");
const carouselContent = $(".slider-content-list"); */

/* let moove = 0; */

(function() {
  function carousel(arrowRight, arrowLeft, moove, carouselContent) {

    let countChildrenElement = $(carouselContent).children('.slider-content-item').length;
  
  
    arrowRight.on("click", function () {
      moove -= 100;
  
      if (moove < -((countChildrenElement - 1) * 100)) {
        moove = 0;
      }
  
      return carouselContent.css("left", (moove + "%"));
    });
  
    arrowLeft.on("click", function () {
      moove += 100;
  
      if (moove > 0) {
        moove = -((countChildrenElement - 1) * 100);
        }
      
  
      return carouselContent.css("left", (moove + "%"));
    });
  
    
  }
  
  carousel(
    $(".slider_arrow-right-wrapper"),
    $(".slider__arrow-left-wrapper"),
    0,
    $(".slider-content-list")
  ); 
  
  
  /* const arrowLeft = document.querySelector(".slider__arrow-left-wrapper");
  const arrowRight = document.querySelector(".slider_arrow-right-wrapper");
  const carouselContent = document.querySelector(".slider-content-list");
  const carouselItem = document.querySelectorAll(".slider-content-item")
  
  let moove = 0;
  
  
  
  function carousel(arrowLeft, arrowRight, carouselContent, moove) {
  
  let countChildrenElement = $(carouselContent).children('.slider-content-item').length;
  
  
  arrowRight.addEventListener("click", function (e) {
  
    
  
    moove = moove - 100;
  
    if (moove < -((countChildrenElement - 1) * 100)) {
    moove = 0;
    }
  
  
    return carouselContent.style.left = moove + "%";
  });
  
  arrowLeft.addEventListener("click", function (event) {
  
    moove = moove + 100;
  
    if (moove > 0) {
    moove = -((countChildrenElement - 1) * 100);
    }
  
   
    return carouselContent.style.left = moove + "%";
  });
  
  
  }
  
  carousel(arrowLeft, arrowRight, carouselContent, 0, ) */
})()

 
;(function() {
  const hamburger = document.querySelector(".hamburger");
  const fullMenu = document.querySelector(".full-menu");
  const closeBtn = document.querySelector("#close-full-menu");
  const FullMenuItem = document.querySelectorAll(".full-menu-item");
  const wrapper = document.querySelector(".wrapper");
  
  hamburger.addEventListener("click", function (event) {
    fullMenu.style.left = "0";
  });
  
  closeBtn.addEventListener("click", function (event) {
    fullMenu.style.left = "100%";
  });
  
  FullMenuItem.forEach(function (element) {
    element.addEventListener("click", function (event) {
      fullMenu.style.left = "100%";
    });
  });
  
  fullMenu.addEventListener("click", function(e){
    if (e.target.className == 'full-menu') {
    fullMenu.style.left = "100%";
    }
  })
  
  window.addEventListener("resize", function (event) {
    if (event.currentTarget.innerWidth > 767) {
      fullMenu.style.left = "100%";
    }
  });
  
})()



;(function() {
  let myMap;

  const init = () => {
    myMap = new ymaps.Map("map", {
      // Координаты центра карты.
      // Порядок по умолчанию: «широта, долгота».
      // Чтобы не определять координаты центра карты вручную,
      // воспользуйтесь инструментом Определение координат.
      center: [55.03, 82.92],
      // Уровень масштабирования. Допустимые значения:
      // от 0 (весь мир) до 19.
      zoom: 16,
      controls:[]
  });
  
  const coords = [
    [55.030439, 82.924504],
    [55.028631, 82.918379],
    [55.031376, 82.917726]
  ];
  
  
  var myCollection = new ymaps.GeoObjectCollection({},{
  
    draggable: false,
    iconLayout: 'default#image',
    iconImageHref: './icons/icon_map.svg',
      iconImageSize: [46, 57],
      iconImageOffset: [-35, -52]
  });
  
  coords.forEach(coord => {
    myCollection.add(new ymaps.Placemark(coord))
  });
  
  myMap.geoObjects.add(myCollection);
  
  myMap.behaviors.disable('scrollZoom');
  
  }
  
  ymaps.ready(init);
})()



;(function() {
  const validateFields = (form, fieldsArray) => {
    fieldsArray.forEach((field) => {
      field.removeClass("input-error");
  
      if (field.val().trim() == "") {
        field.addClass("input-error");
      }
    });
  
    const errorFields = form.find(".input-error");
    return errorFields.length == 0;
  };
  
  $(".form").submit((e) => {
    e.preventDefault();
  
    const form = $(e.currentTarget);
    const name = form.find("[name='name']");
    const phone = form.find("[name='phone']");
    const comment = form.find("[name='comment']");
    const to = form.find("[name='to']");
  
    const modal = $("#modal");
    const content = modal.find(".modal__content");
  
    modal.removeClass("modal-error");
  
    const isValid = validateFields(form, [name, phone, comment, to]);
  
    if (isValid) {
      const request = $.ajax({
        url: "https://webdev-api.loftschool.com/sendmail",
        method: "post",
        data: {
          name: name.val(),
          phone: phone.val(),
          comment: comment.val(),
          to: to.val(),
        },
      });
  
      request.done((data) => {
        content.text(data.message);
      });
  
      request.fail((data) => {
        const message = data.responseJSON.message;
        content.text(message);
        modal.addClass("modal-error");
      });
  
      request.always(() => {
        $.fancybox.open({
          src: "#modal",
          type: "inline",
        });
      });
    }
  });
  
  $(".app-close-modal").click((e) => {
    e.preventDefault();
  
    $.fancybox.close();
  });
})()



;(function () {
  const sections = $("section");
  const display = $(".main__content");
  const sideMenu = $(".fixed-menu");
  const sideMenuItems = sideMenu.find(".fixed-menu__item");

  const mobileDetect = new MobileDetect(window.navigator.userAgent);
  const isMobile = mobileDetect.mobile();

  let inScroll = false;

  sections.first().addClass("active");

  const countSectionPosition = (sectionEq) => {
    const position = sectionEq * -100;

    if (isNaN(position)) {
      console.error("передано неверное значение в countSectionPosition");
      return 0;
    }

    return position;
  };

  const resetActiveClassForItem = (items, itemEq, activeClass) => {
    items.eq(itemEq).addClass(activeClass).siblings().removeClass(activeClass);
  };

  //функция запускающая анимацию
  const performTransition = (sectionEq) => {
    if (inScroll) return;

    inScroll = true;
    const position = countSectionPosition(sectionEq);

    display.css({
      transform: `translateY(${position}%)`,
    });

    resetActiveClassForItem(sections, sectionEq, "active");

    setTimeout(() => {
      inScroll = false;
      resetActiveClassForItem(
        sideMenuItems,
        sectionEq,
        "fixed-menu__item_active"
      );
    }, 1500);
  };

  // функция определяюзаяя к какой секции скролить
  const viewportScroller = () => {
    const activeSection = sections.filter(".active");
    const nextSection = activeSection.next();
    const prevSection = activeSection.prev();

    return {
      next() {
        if (nextSection.length) {
          performTransition(nextSection.index());
        }
      },

      prev() {
        if (prevSection.length) {
          performTransition(prevSection.index());
        }
      },
    };
  };

  $(window).on("wheel", (e) => {
    const deltaY = e.originalEvent.deltaY;
    const scroller = viewportScroller();
    if (deltaY > 0) {
      scroller.next();
    }

    if (deltaY < 0) {
      scroller.prev();
    }
  });

  $(window).on("keydown", (e) => {
    const tagName = e.target.tagName.toLowerCase();
    const userTypingInInputs = tagName == "input" || tagName == "textarea";
    const scroller = viewportScroller();

    if (userTypingInInputs) return;

    switch (e.keyCode) {
      case 40: //prev
        scroller.next();
        break;

      case 38: //next
        scroller.prev();
        break;
    }
  });

  $(".wrapper").on("touchmove", (e) => {
    e.preventDefault();
  });

  $("[data-scroll-to]").click((e) => {
    e.preventDefault();

    const $this = $(e.currentTarget);
    const target = $this.attr("data-scroll-to");
    const reqSection = $(`[data-section-id = ${target}]`);

    performTransition(reqSection.index());
  });

  /* if (isMobile) {
    $("body").swipe( {
      //Generic swipe handler for all directions
      swipe:function(event,direction) {
        
       const scroller = viewportScroller(); 
       let scrollDirection = "";
       
    
       if (direction == "up") scrollDirection = "next";
       if (direction == "down") scrollDirection = "prev";
    
       scroller[scrollDirection]();
    }
    })
  
  }
   */
  if (isMobile) {
    $("body").swipe({
      swipe: function (event, direction) {
        const scroller = viewportScroller();
        let scrollDirection = "";
        if (direction == "up") {
          scrollDirection = "next";
        }

        if (direction == "down") {
          scrollDirection = "prev";
        }

        scroller[scrollDirection]();
      },
    });
  }
})();

;(function() {
//объявляем переменные:

//переменная с круглыми аватарками


const avatars = $('.interactive-avatar');

const displayInner = $('.rewievs__display-inner');


/* const avatars = $('[data-from]');

const displayInner = $('[data-to]');



avatars.on('click', e => {
    e.preventDefault();
    const $this = $(e.currentTarget);

    const displayInnerData = displayInner

    avatars.removeClass('interactive-avatar_active');


    if ($this.hasClass('interactive-avatar')) {
        $this.addClass('interactive-avatar_active')
    }



})  */





//объявляем цикл который перебирает все круглые аватарки
for (let i = 0; i < avatars.length; i++) {
    //присваиваем элементу цикла(конкретной аватрке) переменную элемент
    let element = avatars[i];

    //создаем событие клика на аватарку и функцию которая выполняется при клике
    element.addEventListener("click", function (e) {

        //Внтури функции:

        //отменяем стандартное действие браузера при клике на элемент(ссылка)
        e.preventDefault()

        //снова объявляем цикл который перебирает все круглые аватарки
        for (let index = 0; index < avatars.length; index++) {

            //убираем активный класс всем аватаркам при клике, на тех на которых он есть
            avatars[index].classList.remove('interactive-avatar_active')
            //убираем активный класс дисплею при клике, на тех на которых он есть
            displayInner[index].classList.remove('rewievs__display-inner_active')

        }
        //присваиваем активный класс аватарке, на которурую произвели клик
        displayInner[i].classList.add('rewievs__display-inner_active');
        //присваиваем активный класс дисплею
        e.currentTarget.classList.add('interactive-avatar_active');
    })
}




/* function change(target, 
                i, 
                avatars,
                displayInner, 
                avatarsActive, 
                displayInnerActive, 
                e) {

    e.preventDefault();

    for (let index = 0; 
         index < avatars.length; 
         index++) {

        avatars[index].classList.remove(avatarsActive)
        displayInner[index].classList.remove(displayInnerActive)
    }

    displayInner[i].classList.add(displayInnerActive);
    target.classList.add(avatarsActive);
};



for (let i = 0; 
     i < avatars.length; 
     i++) {

    let element = avatars[i];

    element.addEventListener("click", function (e) {
        
    change( e.currentTarget, 
            i, 
            avatars, 
            displayInner, 
            'interactive-avatar_active', 
            'rewievs__display-inner_active',
            e)
    })
} */
})()


;(function() {
const openItem = function (item) {
  const container = item.closest(".teammate-item");
  const contentBlock = container.find(".position-wrapper");
  const textBLock = contentBlock.find(".position");
  const reqHeight = textBLock.height();
  const arrow = container.find(".team__desc-arrow-img");

  container.addClass("teammate-item_active");
  arrow.addClass("team__desc-arrow-img_active");

  contentBlock.height(reqHeight);
};




const closeEveryItem = function (container) {
  const items = container.find(".position-wrapper");
  const itemContainer = container.find(".teammate-item");
  const itemArrow = container.find(".team__desc-arrow-img");
  items.height(0);

  itemArrow.removeClass("team__desc-arrow-img_active");
  itemContainer.removeClass("teammate-item_active");
};




$(".teammate-name-wrapper").on("click", function (e) {
  const $this = $(e.currentTarget);
  const container = $this.closest(".team");
  const elemContainer = $this.closest(".teammate-item");

  if (elemContainer.hasClass("teammate-item_active")) {
    closeEveryItem(container);
  } else {
    closeEveryItem(container);
    openItem($this);
  }
});

/* const items = $('.teammate-name-wrapper');
const positionWrapper = $('.position-wrapper');
const arrow = $('.team__desc-arrow-img');

items.each((i,item) => {

$(item).on('click', function (e) {

  items.each((j,elem) =>  {

    if (j != i) {
      $(positionWrapper[j]).removeClass('position-wrapper_active');
      $(arrow[j]).removeClass('team__desc-arrow-img_active');
       }

  })
  
    $(positionWrapper[i]).toggleClass('position-wrapper_active');
    $(arrow[i]).toggleClass('team__desc-arrow-img_active');
    
  })

}) */

/* const items = document.querySelectorAll('.teammate-name-wrapper');
const positionWrapper = document.querySelectorAll('.position-wrapper');
const arrow = document.querySelectorAll('.team__desc-arrow-img');


for (let i = 0; i < items.length; i++) {

  let element = items[i];

  element.addEventListener("click", function (e) { 

    for (let j = 0; j < items.length; j++) {


    if (j != i) {
    positionWrapper[j].classList.remove('position-wrapper_active');
    arrow[j].classList.remove('team__desc-arrow-img_active');
     }


    }

    positionWrapper[i].classList.toggle('position-wrapper_active');
    arrow[i].classList.toggle('team__desc-arrow-img_active');
    
    

  })

} */

})()



/* const openAcco = (item) => {

item.addClass("acco-item_active");

}



const closeAcco = (list) => {

  const listItem = list.find(".acco-item"); 
  listItem.removeClass("acco-item_active");

  }


$(".acco-title-wrapper").on('click', (e) => {
    e.preventDefault();
    const $this = $(e.currentTarget);
    const itemContainer = $this.closest(".acco-item");
    const accoList = itemContainer.closest(".acco-list");
    
if (itemContainer.hasClass("acco-item_active")) {
    closeAcco(accoList);



} else {
    closeAcco(accoList);
    openAcco(itemContainer);

    }
}) */





;(function() {


  const maxWidth = document.body.clientWidth;
  console.log(maxWidth);

  
  const openAcco = (item) => {
    item.addClass("acco-item_active");
    
  };
  
  const closeAcco = (list) => {
    const listItem = list.find(".acco-item");
    listItem.removeClass("acco-item_active");
  };
  
  
  
  $(".acco-item").on("click", (e) => {
    e.preventDefault();
    let $this = $(e.target);
    

    if (maxWidth > 480) {
      if ($(e.target).hasClass("acco-title-wrapper") || $(e.target).hasClass("acco-title")) {
        
        const itemContainer = $this.closest(".acco-item");
        const accoList = itemContainer.closest(".acco-list");
    
    
        if (itemContainer.hasClass("acco-item_active")) {
          closeAcco(accoList);
        } else {
          closeAcco(accoList);
          openAcco(itemContainer);
        }
      }
    
      if ($(e.target).hasClass("close-x") || $(e.target).hasClass("close-vert-menu")) {
        const target = $(e.target);
        const Items = target.closest(".acco-list");
    
        closeAcco(Items)
      } else {
        let $this = $(e.currentTarget);
console.log($this.html());
      }
    } 
    
    
  
    
  });
  
})()


;(function() {
  const player = $(".player-elem")[0];
  const playerContainer = $(".player");
  
  $(".play-stop").click((e) => {
    e.preventDefault();
  
    if (playerContainer.hasClass("player_paused")) {
      playerContainer.removeClass("player_paused");
      playerContainer.removeClass("player_active");
      player.pause();
    } else {
      playerContainer.addClass("player_paused");
      player.play();
    }
  });
  
  $(".playback__slider-line").click((e) => {
    const line = $(e.currentTarget);
    const clickedPos = e.originalEvent.layerX;
    const newBtnPosPrecent = (clickedPos / line.width()) * 100;
  
    $(".playback__btn").css({
      left: `${newBtnPosPrecent}%`,
    });
  
    player.pause();
    player.currentTime = player.duration * (clickedPos / line.width());
    player.play();
    playerContainer.addClass("player_paused");
  });
  
  $(player).on("timeupdate", function () {
    let playBackBtn = $(".playback__btn");
    let timeProgress = (player.currentTime / player.duration) * 100 + "%";
    playBackBtn.css("left", timeProgress);
  });
  
  $(".volume__slider-line").click((e) => {
    const volumeLine = $(e.currentTarget);
    const volumeClickedPos = e.originalEvent.layerX;
  
    const volBtnPosPrecent = (volumeClickedPos / volumeLine.width()) * 100;
  
    $(".volume__slider-btn").css({
      left: `${volBtnPosPrecent}%`,
    });
    player.volume = volBtnPosPrecent / 100;
  
    if (playerContainer.hasClass("player__sound-off")) {
      playerContainer.removeClass("player__sound-off");
      player.muted = false;
    }
  });
  
  $(".player-elem").on("play", (e) => {
    playerContainer.addClass("player_active ");
  });
  
  $(".player-splash").on("click", (e) => {
    playerContainer.addClass("player_active player_paused");
    player.play();
  });
  
  $(".volume__icons-wrapper").on("click", (e) => {
    if (playerContainer.hasClass("player__sound-off")) {
      playerContainer.removeClass("player__sound-off");
      player.muted = false;
    } else if ($(e.target).filter("close")) {
      playerContainer.addClass("player__sound-off");
      player.muted = true;
    }
  
  });
  
})()




//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhcm91c2VsLmpzIiwiaGFtYnVyZ2VyLW1lbnUuanMiLCJtYXAuanMiLCJtb2RhbC5qcyIsIm9uZVBhZ2VTY3JvbGwuanMiLCJzbGlkZS1zaG93LmpzIiwidGVhbS1hY2NvcmRpb24uanMiLCJ2ZXJ0aWNhbC1hY2NvLmpzIiwidmlkZW8uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9GQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogXHJcbmNvbnN0IGFycm93TGVmdCA9ICQoXCIuc2xpZGVyX19hcnJvdy1sZWZ0LXdyYXBwZXJcIik7XHJcbmNvbnN0IGFycm93UmlnaHQgPSAkKFwiLnNsaWRlcl9hcnJvdy1yaWdodC13cmFwcGVyXCIpO1xyXG5jb25zdCBjYXJvdXNlbENvbnRlbnQgPSAkKFwiLnNsaWRlci1jb250ZW50LWxpc3RcIik7ICovXHJcblxyXG4vKiBsZXQgbW9vdmUgPSAwOyAqL1xyXG5cclxuKGZ1bmN0aW9uKCkge1xyXG4gIGZ1bmN0aW9uIGNhcm91c2VsKGFycm93UmlnaHQsIGFycm93TGVmdCwgbW9vdmUsIGNhcm91c2VsQ29udGVudCkge1xyXG5cclxuICAgIGxldCBjb3VudENoaWxkcmVuRWxlbWVudCA9ICQoY2Fyb3VzZWxDb250ZW50KS5jaGlsZHJlbignLnNsaWRlci1jb250ZW50LWl0ZW0nKS5sZW5ndGg7XHJcbiAgXHJcbiAgXHJcbiAgICBhcnJvd1JpZ2h0Lm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICBtb292ZSAtPSAxMDA7XHJcbiAgXHJcbiAgICAgIGlmIChtb292ZSA8IC0oKGNvdW50Q2hpbGRyZW5FbGVtZW50IC0gMSkgKiAxMDApKSB7XHJcbiAgICAgICAgbW9vdmUgPSAwO1xyXG4gICAgICB9XHJcbiAgXHJcbiAgICAgIHJldHVybiBjYXJvdXNlbENvbnRlbnQuY3NzKFwibGVmdFwiLCAobW9vdmUgKyBcIiVcIikpO1xyXG4gICAgfSk7XHJcbiAgXHJcbiAgICBhcnJvd0xlZnQub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIG1vb3ZlICs9IDEwMDtcclxuICBcclxuICAgICAgaWYgKG1vb3ZlID4gMCkge1xyXG4gICAgICAgIG1vb3ZlID0gLSgoY291bnRDaGlsZHJlbkVsZW1lbnQgLSAxKSAqIDEwMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICBcclxuICBcclxuICAgICAgcmV0dXJuIGNhcm91c2VsQ29udGVudC5jc3MoXCJsZWZ0XCIsIChtb292ZSArIFwiJVwiKSk7XHJcbiAgICB9KTtcclxuICBcclxuICAgIFxyXG4gIH1cclxuICBcclxuICBjYXJvdXNlbChcclxuICAgICQoXCIuc2xpZGVyX2Fycm93LXJpZ2h0LXdyYXBwZXJcIiksXHJcbiAgICAkKFwiLnNsaWRlcl9fYXJyb3ctbGVmdC13cmFwcGVyXCIpLFxyXG4gICAgMCxcclxuICAgICQoXCIuc2xpZGVyLWNvbnRlbnQtbGlzdFwiKVxyXG4gICk7IFxyXG4gIFxyXG4gIFxyXG4gIC8qIGNvbnN0IGFycm93TGVmdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2xpZGVyX19hcnJvdy1sZWZ0LXdyYXBwZXJcIik7XHJcbiAgY29uc3QgYXJyb3dSaWdodCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2xpZGVyX2Fycm93LXJpZ2h0LXdyYXBwZXJcIik7XHJcbiAgY29uc3QgY2Fyb3VzZWxDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zbGlkZXItY29udGVudC1saXN0XCIpO1xyXG4gIGNvbnN0IGNhcm91c2VsSXRlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc2xpZGVyLWNvbnRlbnQtaXRlbVwiKVxyXG4gIFxyXG4gIGxldCBtb292ZSA9IDA7XHJcbiAgXHJcbiAgXHJcbiAgXHJcbiAgZnVuY3Rpb24gY2Fyb3VzZWwoYXJyb3dMZWZ0LCBhcnJvd1JpZ2h0LCBjYXJvdXNlbENvbnRlbnQsIG1vb3ZlKSB7XHJcbiAgXHJcbiAgbGV0IGNvdW50Q2hpbGRyZW5FbGVtZW50ID0gJChjYXJvdXNlbENvbnRlbnQpLmNoaWxkcmVuKCcuc2xpZGVyLWNvbnRlbnQtaXRlbScpLmxlbmd0aDtcclxuICBcclxuICBcclxuICBhcnJvd1JpZ2h0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gIFxyXG4gICAgXHJcbiAgXHJcbiAgICBtb292ZSA9IG1vb3ZlIC0gMTAwO1xyXG4gIFxyXG4gICAgaWYgKG1vb3ZlIDwgLSgoY291bnRDaGlsZHJlbkVsZW1lbnQgLSAxKSAqIDEwMCkpIHtcclxuICAgIG1vb3ZlID0gMDtcclxuICAgIH1cclxuICBcclxuICBcclxuICAgIHJldHVybiBjYXJvdXNlbENvbnRlbnQuc3R5bGUubGVmdCA9IG1vb3ZlICsgXCIlXCI7XHJcbiAgfSk7XHJcbiAgXHJcbiAgYXJyb3dMZWZ0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICBcclxuICAgIG1vb3ZlID0gbW9vdmUgKyAxMDA7XHJcbiAgXHJcbiAgICBpZiAobW9vdmUgPiAwKSB7XHJcbiAgICBtb292ZSA9IC0oKGNvdW50Q2hpbGRyZW5FbGVtZW50IC0gMSkgKiAxMDApO1xyXG4gICAgfVxyXG4gIFxyXG4gICBcclxuICAgIHJldHVybiBjYXJvdXNlbENvbnRlbnQuc3R5bGUubGVmdCA9IG1vb3ZlICsgXCIlXCI7XHJcbiAgfSk7XHJcbiAgXHJcbiAgXHJcbiAgfVxyXG4gIFxyXG4gIGNhcm91c2VsKGFycm93TGVmdCwgYXJyb3dSaWdodCwgY2Fyb3VzZWxDb250ZW50LCAwLCApICovXHJcbn0pKClcclxuXHJcbiAiLCI7KGZ1bmN0aW9uKCkge1xyXG4gIGNvbnN0IGhhbWJ1cmdlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuaGFtYnVyZ2VyXCIpO1xyXG4gIGNvbnN0IGZ1bGxNZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5mdWxsLW1lbnVcIik7XHJcbiAgY29uc3QgY2xvc2VCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2Nsb3NlLWZ1bGwtbWVudVwiKTtcclxuICBjb25zdCBGdWxsTWVudUl0ZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmZ1bGwtbWVudS1pdGVtXCIpO1xyXG4gIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLndyYXBwZXJcIik7XHJcbiAgXHJcbiAgaGFtYnVyZ2VyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIGZ1bGxNZW51LnN0eWxlLmxlZnQgPSBcIjBcIjtcclxuICB9KTtcclxuICBcclxuICBjbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICBmdWxsTWVudS5zdHlsZS5sZWZ0ID0gXCIxMDAlXCI7XHJcbiAgfSk7XHJcbiAgXHJcbiAgRnVsbE1lbnVJdGVtLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICBmdWxsTWVudS5zdHlsZS5sZWZ0ID0gXCIxMDAlXCI7XHJcbiAgICB9KTtcclxuICB9KTtcclxuICBcclxuICBmdWxsTWVudS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oZSl7XHJcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NOYW1lID09ICdmdWxsLW1lbnUnKSB7XHJcbiAgICBmdWxsTWVudS5zdHlsZS5sZWZ0ID0gXCIxMDAlXCI7XHJcbiAgICB9XHJcbiAgfSlcclxuICBcclxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIGlmIChldmVudC5jdXJyZW50VGFyZ2V0LmlubmVyV2lkdGggPiA3NjcpIHtcclxuICAgICAgZnVsbE1lbnUuc3R5bGUubGVmdCA9IFwiMTAwJVwiO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIFxyXG59KSgpXHJcblxyXG5cclxuIiwiOyhmdW5jdGlvbigpIHtcclxuICBsZXQgbXlNYXA7XHJcblxyXG4gIGNvbnN0IGluaXQgPSAoKSA9PiB7XHJcbiAgICBteU1hcCA9IG5ldyB5bWFwcy5NYXAoXCJtYXBcIiwge1xyXG4gICAgICAvLyDQmtC+0L7RgNC00LjQvdCw0YLRiyDRhtC10L3RgtGA0LAg0LrQsNGA0YLRiy5cclxuICAgICAgLy8g0J/QvtGA0Y/QtNC+0Log0L/QviDRg9C80L7Qu9GH0LDQvdC40Y46IMKr0YjQuNGA0L7RgtCwLCDQtNC+0LvQs9C+0YLQsMK7LlxyXG4gICAgICAvLyDQp9GC0L7QsdGLINC90LUg0L7Qv9GA0LXQtNC10LvRj9GC0Ywg0LrQvtC+0YDQtNC40L3QsNGC0Ysg0YbQtdC90YLRgNCwINC60LDRgNGC0Ysg0LLRgNGD0YfQvdGD0Y4sXHJcbiAgICAgIC8vINCy0L7RgdC/0L7Qu9GM0LfRg9C50YLQtdGB0Ywg0LjQvdGB0YLRgNGD0LzQtdC90YLQvtC8INCe0L/RgNC10LTQtdC70LXQvdC40LUg0LrQvtC+0YDQtNC40L3QsNGCLlxyXG4gICAgICBjZW50ZXI6IFs1NS4wMywgODIuOTJdLFxyXG4gICAgICAvLyDQo9GA0L7QstC10L3RjCDQvNCw0YHRiNGC0LDQsdC40YDQvtCy0LDQvdC40Y8uINCU0L7Qv9GD0YHRgtC40LzRi9C1INC30L3QsNGH0LXQvdC40Y86XHJcbiAgICAgIC8vINC+0YIgMCAo0LLQtdGB0Ywg0LzQuNGAKSDQtNC+IDE5LlxyXG4gICAgICB6b29tOiAxNixcclxuICAgICAgY29udHJvbHM6W11cclxuICB9KTtcclxuICBcclxuICBjb25zdCBjb29yZHMgPSBbXHJcbiAgICBbNTUuMDMwNDM5LCA4Mi45MjQ1MDRdLFxyXG4gICAgWzU1LjAyODYzMSwgODIuOTE4Mzc5XSxcclxuICAgIFs1NS4wMzEzNzYsIDgyLjkxNzcyNl1cclxuICBdO1xyXG4gIFxyXG4gIFxyXG4gIHZhciBteUNvbGxlY3Rpb24gPSBuZXcgeW1hcHMuR2VvT2JqZWN0Q29sbGVjdGlvbih7fSx7XHJcbiAgXHJcbiAgICBkcmFnZ2FibGU6IGZhbHNlLFxyXG4gICAgaWNvbkxheW91dDogJ2RlZmF1bHQjaW1hZ2UnLFxyXG4gICAgaWNvbkltYWdlSHJlZjogJy4vaWNvbnMvaWNvbl9tYXAuc3ZnJyxcclxuICAgICAgaWNvbkltYWdlU2l6ZTogWzQ2LCA1N10sXHJcbiAgICAgIGljb25JbWFnZU9mZnNldDogWy0zNSwgLTUyXVxyXG4gIH0pO1xyXG4gIFxyXG4gIGNvb3Jkcy5mb3JFYWNoKGNvb3JkID0+IHtcclxuICAgIG15Q29sbGVjdGlvbi5hZGQobmV3IHltYXBzLlBsYWNlbWFyayhjb29yZCkpXHJcbiAgfSk7XHJcbiAgXHJcbiAgbXlNYXAuZ2VvT2JqZWN0cy5hZGQobXlDb2xsZWN0aW9uKTtcclxuICBcclxuICBteU1hcC5iZWhhdmlvcnMuZGlzYWJsZSgnc2Nyb2xsWm9vbScpO1xyXG4gIFxyXG4gIH1cclxuICBcclxuICB5bWFwcy5yZWFkeShpbml0KTtcclxufSkoKVxyXG5cclxuXHJcbiIsIjsoZnVuY3Rpb24oKSB7XHJcbiAgY29uc3QgdmFsaWRhdGVGaWVsZHMgPSAoZm9ybSwgZmllbGRzQXJyYXkpID0+IHtcclxuICAgIGZpZWxkc0FycmF5LmZvckVhY2goKGZpZWxkKSA9PiB7XHJcbiAgICAgIGZpZWxkLnJlbW92ZUNsYXNzKFwiaW5wdXQtZXJyb3JcIik7XHJcbiAgXHJcbiAgICAgIGlmIChmaWVsZC52YWwoKS50cmltKCkgPT0gXCJcIikge1xyXG4gICAgICAgIGZpZWxkLmFkZENsYXNzKFwiaW5wdXQtZXJyb3JcIik7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIFxyXG4gICAgY29uc3QgZXJyb3JGaWVsZHMgPSBmb3JtLmZpbmQoXCIuaW5wdXQtZXJyb3JcIik7XHJcbiAgICByZXR1cm4gZXJyb3JGaWVsZHMubGVuZ3RoID09IDA7XHJcbiAgfTtcclxuICBcclxuICAkKFwiLmZvcm1cIikuc3VibWl0KChlKSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgXHJcbiAgICBjb25zdCBmb3JtID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgY29uc3QgbmFtZSA9IGZvcm0uZmluZChcIltuYW1lPSduYW1lJ11cIik7XHJcbiAgICBjb25zdCBwaG9uZSA9IGZvcm0uZmluZChcIltuYW1lPSdwaG9uZSddXCIpO1xyXG4gICAgY29uc3QgY29tbWVudCA9IGZvcm0uZmluZChcIltuYW1lPSdjb21tZW50J11cIik7XHJcbiAgICBjb25zdCB0byA9IGZvcm0uZmluZChcIltuYW1lPSd0byddXCIpO1xyXG4gIFxyXG4gICAgY29uc3QgbW9kYWwgPSAkKFwiI21vZGFsXCIpO1xyXG4gICAgY29uc3QgY29udGVudCA9IG1vZGFsLmZpbmQoXCIubW9kYWxfX2NvbnRlbnRcIik7XHJcbiAgXHJcbiAgICBtb2RhbC5yZW1vdmVDbGFzcyhcIm1vZGFsLWVycm9yXCIpO1xyXG4gIFxyXG4gICAgY29uc3QgaXNWYWxpZCA9IHZhbGlkYXRlRmllbGRzKGZvcm0sIFtuYW1lLCBwaG9uZSwgY29tbWVudCwgdG9dKTtcclxuICBcclxuICAgIGlmIChpc1ZhbGlkKSB7XHJcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSAkLmFqYXgoe1xyXG4gICAgICAgIHVybDogXCJodHRwczovL3dlYmRldi1hcGkubG9mdHNjaG9vbC5jb20vc2VuZG1haWxcIixcclxuICAgICAgICBtZXRob2Q6IFwicG9zdFwiLFxyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgIG5hbWU6IG5hbWUudmFsKCksXHJcbiAgICAgICAgICBwaG9uZTogcGhvbmUudmFsKCksXHJcbiAgICAgICAgICBjb21tZW50OiBjb21tZW50LnZhbCgpLFxyXG4gICAgICAgICAgdG86IHRvLnZhbCgpLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pO1xyXG4gIFxyXG4gICAgICByZXF1ZXN0LmRvbmUoKGRhdGEpID0+IHtcclxuICAgICAgICBjb250ZW50LnRleHQoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgfSk7XHJcbiAgXHJcbiAgICAgIHJlcXVlc3QuZmFpbCgoZGF0YSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBkYXRhLnJlc3BvbnNlSlNPTi5tZXNzYWdlO1xyXG4gICAgICAgIGNvbnRlbnQudGV4dChtZXNzYWdlKTtcclxuICAgICAgICBtb2RhbC5hZGRDbGFzcyhcIm1vZGFsLWVycm9yXCIpO1xyXG4gICAgICB9KTtcclxuICBcclxuICAgICAgcmVxdWVzdC5hbHdheXMoKCkgPT4ge1xyXG4gICAgICAgICQuZmFuY3lib3gub3Blbih7XHJcbiAgICAgICAgICBzcmM6IFwiI21vZGFsXCIsXHJcbiAgICAgICAgICB0eXBlOiBcImlubGluZVwiLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9KTtcclxuICBcclxuICAkKFwiLmFwcC1jbG9zZS1tb2RhbFwiKS5jbGljaygoZSkgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIFxyXG4gICAgJC5mYW5jeWJveC5jbG9zZSgpO1xyXG4gIH0pO1xyXG59KSgpXHJcblxyXG5cclxuIiwiOyhmdW5jdGlvbiAoKSB7XHJcbiAgY29uc3Qgc2VjdGlvbnMgPSAkKFwic2VjdGlvblwiKTtcclxuICBjb25zdCBkaXNwbGF5ID0gJChcIi5tYWluX19jb250ZW50XCIpO1xyXG4gIGNvbnN0IHNpZGVNZW51ID0gJChcIi5maXhlZC1tZW51XCIpO1xyXG4gIGNvbnN0IHNpZGVNZW51SXRlbXMgPSBzaWRlTWVudS5maW5kKFwiLmZpeGVkLW1lbnVfX2l0ZW1cIik7XHJcblxyXG4gIGNvbnN0IG1vYmlsZURldGVjdCA9IG5ldyBNb2JpbGVEZXRlY3Qod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpO1xyXG4gIGNvbnN0IGlzTW9iaWxlID0gbW9iaWxlRGV0ZWN0Lm1vYmlsZSgpO1xyXG5cclxuICBsZXQgaW5TY3JvbGwgPSBmYWxzZTtcclxuXHJcbiAgc2VjdGlvbnMuZmlyc3QoKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcclxuXHJcbiAgY29uc3QgY291bnRTZWN0aW9uUG9zaXRpb24gPSAoc2VjdGlvbkVxKSA9PiB7XHJcbiAgICBjb25zdCBwb3NpdGlvbiA9IHNlY3Rpb25FcSAqIC0xMDA7XHJcblxyXG4gICAgaWYgKGlzTmFOKHBvc2l0aW9uKSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwi0L/QtdGA0LXQtNCw0L3QviDQvdC10LLQtdGA0L3QvtC1INC30L3QsNGH0LXQvdC40LUg0LIgY291bnRTZWN0aW9uUG9zaXRpb25cIik7XHJcbiAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBwb3NpdGlvbjtcclxuICB9O1xyXG5cclxuICBjb25zdCByZXNldEFjdGl2ZUNsYXNzRm9ySXRlbSA9IChpdGVtcywgaXRlbUVxLCBhY3RpdmVDbGFzcykgPT4ge1xyXG4gICAgaXRlbXMuZXEoaXRlbUVxKS5hZGRDbGFzcyhhY3RpdmVDbGFzcykuc2libGluZ3MoKS5yZW1vdmVDbGFzcyhhY3RpdmVDbGFzcyk7XHJcbiAgfTtcclxuXHJcbiAgLy/RhNGD0L3QutGG0LjRjyDQt9Cw0L/Rg9GB0LrQsNGO0YnQsNGPINCw0L3QuNC80LDRhtC40Y5cclxuICBjb25zdCBwZXJmb3JtVHJhbnNpdGlvbiA9IChzZWN0aW9uRXEpID0+IHtcclxuICAgIGlmIChpblNjcm9sbCkgcmV0dXJuO1xyXG5cclxuICAgIGluU2Nyb2xsID0gdHJ1ZTtcclxuICAgIGNvbnN0IHBvc2l0aW9uID0gY291bnRTZWN0aW9uUG9zaXRpb24oc2VjdGlvbkVxKTtcclxuXHJcbiAgICBkaXNwbGF5LmNzcyh7XHJcbiAgICAgIHRyYW5zZm9ybTogYHRyYW5zbGF0ZVkoJHtwb3NpdGlvbn0lKWAsXHJcbiAgICB9KTtcclxuXHJcbiAgICByZXNldEFjdGl2ZUNsYXNzRm9ySXRlbShzZWN0aW9ucywgc2VjdGlvbkVxLCBcImFjdGl2ZVwiKTtcclxuXHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgaW5TY3JvbGwgPSBmYWxzZTtcclxuICAgICAgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0oXHJcbiAgICAgICAgc2lkZU1lbnVJdGVtcyxcclxuICAgICAgICBzZWN0aW9uRXEsXHJcbiAgICAgICAgXCJmaXhlZC1tZW51X19pdGVtX2FjdGl2ZVwiXHJcbiAgICAgICk7XHJcbiAgICB9LCAxNTAwKTtcclxuICB9O1xyXG5cclxuICAvLyDRhNGD0L3QutGG0LjRjyDQvtC/0YDQtdC00LXQu9GP0Y7Qt9Cw0Y/RjyDQuiDQutCw0LrQvtC5INGB0LXQutGG0LjQuCDRgdC60YDQvtC70LjRgtGMXHJcbiAgY29uc3Qgdmlld3BvcnRTY3JvbGxlciA9ICgpID0+IHtcclxuICAgIGNvbnN0IGFjdGl2ZVNlY3Rpb24gPSBzZWN0aW9ucy5maWx0ZXIoXCIuYWN0aXZlXCIpO1xyXG4gICAgY29uc3QgbmV4dFNlY3Rpb24gPSBhY3RpdmVTZWN0aW9uLm5leHQoKTtcclxuICAgIGNvbnN0IHByZXZTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5wcmV2KCk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbmV4dCgpIHtcclxuICAgICAgICBpZiAobmV4dFNlY3Rpb24ubGVuZ3RoKSB7XHJcbiAgICAgICAgICBwZXJmb3JtVHJhbnNpdGlvbihuZXh0U2VjdGlvbi5pbmRleCgpKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICBwcmV2KCkge1xyXG4gICAgICAgIGlmIChwcmV2U2VjdGlvbi5sZW5ndGgpIHtcclxuICAgICAgICAgIHBlcmZvcm1UcmFuc2l0aW9uKHByZXZTZWN0aW9uLmluZGV4KCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgIH07XHJcbiAgfTtcclxuXHJcbiAgJCh3aW5kb3cpLm9uKFwid2hlZWxcIiwgKGUpID0+IHtcclxuICAgIGNvbnN0IGRlbHRhWSA9IGUub3JpZ2luYWxFdmVudC5kZWx0YVk7XHJcbiAgICBjb25zdCBzY3JvbGxlciA9IHZpZXdwb3J0U2Nyb2xsZXIoKTtcclxuICAgIGlmIChkZWx0YVkgPiAwKSB7XHJcbiAgICAgIHNjcm9sbGVyLm5leHQoKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZGVsdGFZIDwgMCkge1xyXG4gICAgICBzY3JvbGxlci5wcmV2KCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gICQod2luZG93KS5vbihcImtleWRvd25cIiwgKGUpID0+IHtcclxuICAgIGNvbnN0IHRhZ05hbWUgPSBlLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICBjb25zdCB1c2VyVHlwaW5nSW5JbnB1dHMgPSB0YWdOYW1lID09IFwiaW5wdXRcIiB8fCB0YWdOYW1lID09IFwidGV4dGFyZWFcIjtcclxuICAgIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xyXG5cclxuICAgIGlmICh1c2VyVHlwaW5nSW5JbnB1dHMpIHJldHVybjtcclxuXHJcbiAgICBzd2l0Y2ggKGUua2V5Q29kZSkge1xyXG4gICAgICBjYXNlIDQwOiAvL3ByZXZcclxuICAgICAgICBzY3JvbGxlci5uZXh0KCk7XHJcbiAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICBjYXNlIDM4OiAvL25leHRcclxuICAgICAgICBzY3JvbGxlci5wcmV2KCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gICQoXCIud3JhcHBlclwiKS5vbihcInRvdWNobW92ZVwiLCAoZSkgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIH0pO1xyXG5cclxuICAkKFwiW2RhdGEtc2Nyb2xsLXRvXVwiKS5jbGljaygoZSkgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cihcImRhdGEtc2Nyb2xsLXRvXCIpO1xyXG4gICAgY29uc3QgcmVxU2VjdGlvbiA9ICQoYFtkYXRhLXNlY3Rpb24taWQgPSAke3RhcmdldH1dYCk7XHJcblxyXG4gICAgcGVyZm9ybVRyYW5zaXRpb24ocmVxU2VjdGlvbi5pbmRleCgpKTtcclxuICB9KTtcclxuXHJcbiAgLyogaWYgKGlzTW9iaWxlKSB7XHJcbiAgICAkKFwiYm9keVwiKS5zd2lwZSgge1xyXG4gICAgICAvL0dlbmVyaWMgc3dpcGUgaGFuZGxlciBmb3IgYWxsIGRpcmVjdGlvbnNcclxuICAgICAgc3dpcGU6ZnVuY3Rpb24oZXZlbnQsZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgXHJcbiAgICAgICBjb25zdCBzY3JvbGxlciA9IHZpZXdwb3J0U2Nyb2xsZXIoKTsgXHJcbiAgICAgICBsZXQgc2Nyb2xsRGlyZWN0aW9uID0gXCJcIjtcclxuICAgICAgIFxyXG4gICAgXHJcbiAgICAgICBpZiAoZGlyZWN0aW9uID09IFwidXBcIikgc2Nyb2xsRGlyZWN0aW9uID0gXCJuZXh0XCI7XHJcbiAgICAgICBpZiAoZGlyZWN0aW9uID09IFwiZG93blwiKSBzY3JvbGxEaXJlY3Rpb24gPSBcInByZXZcIjtcclxuICAgIFxyXG4gICAgICAgc2Nyb2xsZXJbc2Nyb2xsRGlyZWN0aW9uXSgpO1xyXG4gICAgfVxyXG4gICAgfSlcclxuICBcclxuICB9XHJcbiAgICovXHJcbiAgaWYgKGlzTW9iaWxlKSB7XHJcbiAgICAkKFwiYm9keVwiKS5zd2lwZSh7XHJcbiAgICAgIHN3aXBlOiBmdW5jdGlvbiAoZXZlbnQsIGRpcmVjdGlvbikge1xyXG4gICAgICAgIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xyXG4gICAgICAgIGxldCBzY3JvbGxEaXJlY3Rpb24gPSBcIlwiO1xyXG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT0gXCJ1cFwiKSB7XHJcbiAgICAgICAgICBzY3JvbGxEaXJlY3Rpb24gPSBcIm5leHRcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT0gXCJkb3duXCIpIHtcclxuICAgICAgICAgIHNjcm9sbERpcmVjdGlvbiA9IFwicHJldlwiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2Nyb2xsZXJbc2Nyb2xsRGlyZWN0aW9uXSgpO1xyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcbiAgfVxyXG59KSgpO1xyXG4iLCI7KGZ1bmN0aW9uKCkge1xyXG4vL9C+0LHRitGP0LLQu9GP0LXQvCDQv9C10YDQtdC80LXQvdC90YvQtTpcclxuXHJcbi8v0L/QtdGA0LXQvNC10L3QvdCw0Y8g0YEg0LrRgNGD0LPQu9GL0LzQuCDQsNCy0LDRgtCw0YDQutCw0LzQuFxyXG5cclxuXHJcbmNvbnN0IGF2YXRhcnMgPSAkKCcuaW50ZXJhY3RpdmUtYXZhdGFyJyk7XHJcblxyXG5jb25zdCBkaXNwbGF5SW5uZXIgPSAkKCcucmV3aWV2c19fZGlzcGxheS1pbm5lcicpO1xyXG5cclxuXHJcbi8qIGNvbnN0IGF2YXRhcnMgPSAkKCdbZGF0YS1mcm9tXScpO1xyXG5cclxuY29uc3QgZGlzcGxheUlubmVyID0gJCgnW2RhdGEtdG9dJyk7XHJcblxyXG5cclxuXHJcbmF2YXRhcnMub24oJ2NsaWNrJywgZSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuXHJcbiAgICBjb25zdCBkaXNwbGF5SW5uZXJEYXRhID0gZGlzcGxheUlubmVyXHJcblxyXG4gICAgYXZhdGFycy5yZW1vdmVDbGFzcygnaW50ZXJhY3RpdmUtYXZhdGFyX2FjdGl2ZScpO1xyXG5cclxuXHJcbiAgICBpZiAoJHRoaXMuaGFzQ2xhc3MoJ2ludGVyYWN0aXZlLWF2YXRhcicpKSB7XHJcbiAgICAgICAgJHRoaXMuYWRkQ2xhc3MoJ2ludGVyYWN0aXZlLWF2YXRhcl9hY3RpdmUnKVxyXG4gICAgfVxyXG5cclxuXHJcblxyXG59KSAgKi9cclxuXHJcblxyXG5cclxuXHJcblxyXG4vL9C+0LHRitGP0LLQu9GP0LXQvCDRhtC40LrQuyDQutC+0YLQvtGA0YvQuSDQv9C10YDQtdCx0LjRgNCw0LXRgiDQstGB0LUg0LrRgNGD0LPQu9GL0LUg0LDQstCw0YLQsNGA0LrQuFxyXG5mb3IgKGxldCBpID0gMDsgaSA8IGF2YXRhcnMubGVuZ3RoOyBpKyspIHtcclxuICAgIC8v0L/RgNC40YHQstCw0LjQstCw0LXQvCDRjdC70LXQvNC10L3RgtGDINGG0LjQutC70LAo0LrQvtC90LrRgNC10YLQvdC+0Lkg0LDQstCw0YLRgNC60LUpINC/0LXRgNC10LzQtdC90L3Rg9GOINGN0LvQtdC80LXQvdGCXHJcbiAgICBsZXQgZWxlbWVudCA9IGF2YXRhcnNbaV07XHJcblxyXG4gICAgLy/RgdC+0LfQtNCw0LXQvCDRgdC+0LHRi9GC0LjQtSDQutC70LjQutCwINC90LAg0LDQstCw0YLQsNGA0LrRgyDQuCDRhNGD0L3QutGG0LjRjiDQutC+0YLQvtGA0LDRjyDQstGL0L/QvtC70L3Rj9C10YLRgdGPINC/0YDQuCDQutC70LjQutC1XHJcbiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG5cclxuICAgICAgICAvL9CS0L3RgtGD0YDQuCDRhNGD0L3QutGG0LjQuDpcclxuXHJcbiAgICAgICAgLy/QvtGC0LzQtdC90Y/QtdC8INGB0YLQsNC90LTQsNGA0YLQvdC+0LUg0LTQtdC50YHRgtCy0LjQtSDQsdGA0LDRg9C30LXRgNCwINC/0YDQuCDQutC70LjQutC1INC90LAg0Y3Qu9C10LzQtdC90YIo0YHRgdGL0LvQutCwKVxyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKVxyXG5cclxuICAgICAgICAvL9GB0L3QvtCy0LAg0L7QsdGK0Y/QstC70Y/QtdC8INGG0LjQutC7INC60L7RgtC+0YDRi9C5INC/0LXRgNC10LHQuNGA0LDQtdGCINCy0YHQtSDQutGA0YPQs9C70YvQtSDQsNCy0LDRgtCw0YDQutC4XHJcbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGF2YXRhcnMubGVuZ3RoOyBpbmRleCsrKSB7XHJcblxyXG4gICAgICAgICAgICAvL9GD0LHQuNGA0LDQtdC8INCw0LrRgtC40LLQvdGL0Lkg0LrQu9Cw0YHRgSDQstGB0LXQvCDQsNCy0LDRgtCw0YDQutCw0Lwg0L/RgNC4INC60LvQuNC60LUsINC90LAg0YLQtdGFINC90LAg0LrQvtGC0L7RgNGL0YUg0L7QvSDQtdGB0YLRjFxyXG4gICAgICAgICAgICBhdmF0YXJzW2luZGV4XS5jbGFzc0xpc3QucmVtb3ZlKCdpbnRlcmFjdGl2ZS1hdmF0YXJfYWN0aXZlJylcclxuICAgICAgICAgICAgLy/Rg9Cx0LjRgNCw0LXQvCDQsNC60YLQuNCy0L3Ri9C5INC60LvQsNGB0YEg0LTQuNGB0L/Qu9C10Y4g0L/RgNC4INC60LvQuNC60LUsINC90LAg0YLQtdGFINC90LAg0LrQvtGC0L7RgNGL0YUg0L7QvSDQtdGB0YLRjFxyXG4gICAgICAgICAgICBkaXNwbGF5SW5uZXJbaW5kZXhdLmNsYXNzTGlzdC5yZW1vdmUoJ3Jld2lldnNfX2Rpc3BsYXktaW5uZXJfYWN0aXZlJylcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8v0L/RgNC40YHQstCw0LjQstCw0LXQvCDQsNC60YLQuNCy0L3Ri9C5INC60LvQsNGB0YEg0LDQstCw0YLQsNGA0LrQtSwg0L3QsCDQutC+0YLQvtGA0YPRgNGD0Y4g0L/RgNC+0LjQt9Cy0LXQu9C4INC60LvQuNC6XHJcbiAgICAgICAgZGlzcGxheUlubmVyW2ldLmNsYXNzTGlzdC5hZGQoJ3Jld2lldnNfX2Rpc3BsYXktaW5uZXJfYWN0aXZlJyk7XHJcbiAgICAgICAgLy/Qv9GA0LjRgdCy0LDQuNCy0LDQtdC8INCw0LrRgtC40LLQvdGL0Lkg0LrQu9Cw0YHRgSDQtNC40YHQv9C70LXRjlxyXG4gICAgICAgIGUuY3VycmVudFRhcmdldC5jbGFzc0xpc3QuYWRkKCdpbnRlcmFjdGl2ZS1hdmF0YXJfYWN0aXZlJyk7XHJcbiAgICB9KVxyXG59XHJcblxyXG5cclxuXHJcblxyXG4vKiBmdW5jdGlvbiBjaGFuZ2UodGFyZ2V0LCBcclxuICAgICAgICAgICAgICAgIGksIFxyXG4gICAgICAgICAgICAgICAgYXZhdGFycyxcclxuICAgICAgICAgICAgICAgIGRpc3BsYXlJbm5lciwgXHJcbiAgICAgICAgICAgICAgICBhdmF0YXJzQWN0aXZlLCBcclxuICAgICAgICAgICAgICAgIGRpc3BsYXlJbm5lckFjdGl2ZSwgXHJcbiAgICAgICAgICAgICAgICBlKSB7XHJcblxyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgIGZvciAobGV0IGluZGV4ID0gMDsgXHJcbiAgICAgICAgIGluZGV4IDwgYXZhdGFycy5sZW5ndGg7IFxyXG4gICAgICAgICBpbmRleCsrKSB7XHJcblxyXG4gICAgICAgIGF2YXRhcnNbaW5kZXhdLmNsYXNzTGlzdC5yZW1vdmUoYXZhdGFyc0FjdGl2ZSlcclxuICAgICAgICBkaXNwbGF5SW5uZXJbaW5kZXhdLmNsYXNzTGlzdC5yZW1vdmUoZGlzcGxheUlubmVyQWN0aXZlKVxyXG4gICAgfVxyXG5cclxuICAgIGRpc3BsYXlJbm5lcltpXS5jbGFzc0xpc3QuYWRkKGRpc3BsYXlJbm5lckFjdGl2ZSk7XHJcbiAgICB0YXJnZXQuY2xhc3NMaXN0LmFkZChhdmF0YXJzQWN0aXZlKTtcclxufTtcclxuXHJcblxyXG5cclxuZm9yIChsZXQgaSA9IDA7IFxyXG4gICAgIGkgPCBhdmF0YXJzLmxlbmd0aDsgXHJcbiAgICAgaSsrKSB7XHJcblxyXG4gICAgbGV0IGVsZW1lbnQgPSBhdmF0YXJzW2ldO1xyXG5cclxuICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgXHJcbiAgICBjaGFuZ2UoIGUuY3VycmVudFRhcmdldCwgXHJcbiAgICAgICAgICAgIGksIFxyXG4gICAgICAgICAgICBhdmF0YXJzLCBcclxuICAgICAgICAgICAgZGlzcGxheUlubmVyLCBcclxuICAgICAgICAgICAgJ2ludGVyYWN0aXZlLWF2YXRhcl9hY3RpdmUnLCBcclxuICAgICAgICAgICAgJ3Jld2lldnNfX2Rpc3BsYXktaW5uZXJfYWN0aXZlJyxcclxuICAgICAgICAgICAgZSlcclxuICAgIH0pXHJcbn0gKi9cclxufSkoKVxyXG5cclxuIiwiOyhmdW5jdGlvbigpIHtcclxuY29uc3Qgb3Blbkl0ZW0gPSBmdW5jdGlvbiAoaXRlbSkge1xyXG4gIGNvbnN0IGNvbnRhaW5lciA9IGl0ZW0uY2xvc2VzdChcIi50ZWFtbWF0ZS1pdGVtXCIpO1xyXG4gIGNvbnN0IGNvbnRlbnRCbG9jayA9IGNvbnRhaW5lci5maW5kKFwiLnBvc2l0aW9uLXdyYXBwZXJcIik7XHJcbiAgY29uc3QgdGV4dEJMb2NrID0gY29udGVudEJsb2NrLmZpbmQoXCIucG9zaXRpb25cIik7XHJcbiAgY29uc3QgcmVxSGVpZ2h0ID0gdGV4dEJMb2NrLmhlaWdodCgpO1xyXG4gIGNvbnN0IGFycm93ID0gY29udGFpbmVyLmZpbmQoXCIudGVhbV9fZGVzYy1hcnJvdy1pbWdcIik7XHJcblxyXG4gIGNvbnRhaW5lci5hZGRDbGFzcyhcInRlYW1tYXRlLWl0ZW1fYWN0aXZlXCIpO1xyXG4gIGFycm93LmFkZENsYXNzKFwidGVhbV9fZGVzYy1hcnJvdy1pbWdfYWN0aXZlXCIpO1xyXG5cclxuICBjb250ZW50QmxvY2suaGVpZ2h0KHJlcUhlaWdodCk7XHJcbn07XHJcblxyXG5cclxuXHJcblxyXG5jb25zdCBjbG9zZUV2ZXJ5SXRlbSA9IGZ1bmN0aW9uIChjb250YWluZXIpIHtcclxuICBjb25zdCBpdGVtcyA9IGNvbnRhaW5lci5maW5kKFwiLnBvc2l0aW9uLXdyYXBwZXJcIik7XHJcbiAgY29uc3QgaXRlbUNvbnRhaW5lciA9IGNvbnRhaW5lci5maW5kKFwiLnRlYW1tYXRlLWl0ZW1cIik7XHJcbiAgY29uc3QgaXRlbUFycm93ID0gY29udGFpbmVyLmZpbmQoXCIudGVhbV9fZGVzYy1hcnJvdy1pbWdcIik7XHJcbiAgaXRlbXMuaGVpZ2h0KDApO1xyXG5cclxuICBpdGVtQXJyb3cucmVtb3ZlQ2xhc3MoXCJ0ZWFtX19kZXNjLWFycm93LWltZ19hY3RpdmVcIik7XHJcbiAgaXRlbUNvbnRhaW5lci5yZW1vdmVDbGFzcyhcInRlYW1tYXRlLWl0ZW1fYWN0aXZlXCIpO1xyXG59O1xyXG5cclxuXHJcblxyXG5cclxuJChcIi50ZWFtbWF0ZS1uYW1lLXdyYXBwZXJcIikub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gIGNvbnN0IGNvbnRhaW5lciA9ICR0aGlzLmNsb3Nlc3QoXCIudGVhbVwiKTtcclxuICBjb25zdCBlbGVtQ29udGFpbmVyID0gJHRoaXMuY2xvc2VzdChcIi50ZWFtbWF0ZS1pdGVtXCIpO1xyXG5cclxuICBpZiAoZWxlbUNvbnRhaW5lci5oYXNDbGFzcyhcInRlYW1tYXRlLWl0ZW1fYWN0aXZlXCIpKSB7XHJcbiAgICBjbG9zZUV2ZXJ5SXRlbShjb250YWluZXIpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjbG9zZUV2ZXJ5SXRlbShjb250YWluZXIpO1xyXG4gICAgb3Blbkl0ZW0oJHRoaXMpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vKiBjb25zdCBpdGVtcyA9ICQoJy50ZWFtbWF0ZS1uYW1lLXdyYXBwZXInKTtcclxuY29uc3QgcG9zaXRpb25XcmFwcGVyID0gJCgnLnBvc2l0aW9uLXdyYXBwZXInKTtcclxuY29uc3QgYXJyb3cgPSAkKCcudGVhbV9fZGVzYy1hcnJvdy1pbWcnKTtcclxuXHJcbml0ZW1zLmVhY2goKGksaXRlbSkgPT4ge1xyXG5cclxuJChpdGVtKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG5cclxuICBpdGVtcy5lYWNoKChqLGVsZW0pID0+ICB7XHJcblxyXG4gICAgaWYgKGogIT0gaSkge1xyXG4gICAgICAkKHBvc2l0aW9uV3JhcHBlcltqXSkucmVtb3ZlQ2xhc3MoJ3Bvc2l0aW9uLXdyYXBwZXJfYWN0aXZlJyk7XHJcbiAgICAgICQoYXJyb3dbal0pLnJlbW92ZUNsYXNzKCd0ZWFtX19kZXNjLWFycm93LWltZ19hY3RpdmUnKTtcclxuICAgICAgIH1cclxuXHJcbiAgfSlcclxuICBcclxuICAgICQocG9zaXRpb25XcmFwcGVyW2ldKS50b2dnbGVDbGFzcygncG9zaXRpb24td3JhcHBlcl9hY3RpdmUnKTtcclxuICAgICQoYXJyb3dbaV0pLnRvZ2dsZUNsYXNzKCd0ZWFtX19kZXNjLWFycm93LWltZ19hY3RpdmUnKTtcclxuICAgIFxyXG4gIH0pXHJcblxyXG59KSAqL1xyXG5cclxuLyogY29uc3QgaXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudGVhbW1hdGUtbmFtZS13cmFwcGVyJyk7XHJcbmNvbnN0IHBvc2l0aW9uV3JhcHBlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wb3NpdGlvbi13cmFwcGVyJyk7XHJcbmNvbnN0IGFycm93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRlYW1fX2Rlc2MtYXJyb3ctaW1nJyk7XHJcblxyXG5cclxuZm9yIChsZXQgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykge1xyXG5cclxuICBsZXQgZWxlbWVudCA9IGl0ZW1zW2ldO1xyXG5cclxuICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkgeyBcclxuXHJcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGl0ZW1zLmxlbmd0aDsgaisrKSB7XHJcblxyXG5cclxuICAgIGlmIChqICE9IGkpIHtcclxuICAgIHBvc2l0aW9uV3JhcHBlcltqXS5jbGFzc0xpc3QucmVtb3ZlKCdwb3NpdGlvbi13cmFwcGVyX2FjdGl2ZScpO1xyXG4gICAgYXJyb3dbal0uY2xhc3NMaXN0LnJlbW92ZSgndGVhbV9fZGVzYy1hcnJvdy1pbWdfYWN0aXZlJyk7XHJcbiAgICAgfVxyXG5cclxuXHJcbiAgICB9XHJcblxyXG4gICAgcG9zaXRpb25XcmFwcGVyW2ldLmNsYXNzTGlzdC50b2dnbGUoJ3Bvc2l0aW9uLXdyYXBwZXJfYWN0aXZlJyk7XHJcbiAgICBhcnJvd1tpXS5jbGFzc0xpc3QudG9nZ2xlKCd0ZWFtX19kZXNjLWFycm93LWltZ19hY3RpdmUnKTtcclxuICAgIFxyXG4gICAgXHJcblxyXG4gIH0pXHJcblxyXG59ICovXHJcblxyXG59KSgpXHJcblxyXG5cclxuIiwiLyogY29uc3Qgb3BlbkFjY28gPSAoaXRlbSkgPT4ge1xyXG5cclxuaXRlbS5hZGRDbGFzcyhcImFjY28taXRlbV9hY3RpdmVcIik7XHJcblxyXG59XHJcblxyXG5cclxuXHJcbmNvbnN0IGNsb3NlQWNjbyA9IChsaXN0KSA9PiB7XHJcblxyXG4gIGNvbnN0IGxpc3RJdGVtID0gbGlzdC5maW5kKFwiLmFjY28taXRlbVwiKTsgXHJcbiAgbGlzdEl0ZW0ucmVtb3ZlQ2xhc3MoXCJhY2NvLWl0ZW1fYWN0aXZlXCIpO1xyXG5cclxuICB9XHJcblxyXG5cclxuJChcIi5hY2NvLXRpdGxlLXdyYXBwZXJcIikub24oJ2NsaWNrJywgKGUpID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgY29uc3QgaXRlbUNvbnRhaW5lciA9ICR0aGlzLmNsb3Nlc3QoXCIuYWNjby1pdGVtXCIpO1xyXG4gICAgY29uc3QgYWNjb0xpc3QgPSBpdGVtQ29udGFpbmVyLmNsb3Nlc3QoXCIuYWNjby1saXN0XCIpO1xyXG4gICAgXHJcbmlmIChpdGVtQ29udGFpbmVyLmhhc0NsYXNzKFwiYWNjby1pdGVtX2FjdGl2ZVwiKSkge1xyXG4gICAgY2xvc2VBY2NvKGFjY29MaXN0KTtcclxuXHJcblxyXG5cclxufSBlbHNlIHtcclxuICAgIGNsb3NlQWNjbyhhY2NvTGlzdCk7XHJcbiAgICBvcGVuQWNjbyhpdGVtQ29udGFpbmVyKTtcclxuXHJcbiAgICB9XHJcbn0pICovXHJcblxyXG5cclxuXHJcblxyXG5cclxuOyhmdW5jdGlvbigpIHtcclxuXHJcblxyXG4gIGNvbnN0IG1heFdpZHRoID0gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDtcclxuICBjb25zb2xlLmxvZyhtYXhXaWR0aCk7XHJcblxyXG4gIFxyXG4gIGNvbnN0IG9wZW5BY2NvID0gKGl0ZW0pID0+IHtcclxuICAgIGl0ZW0uYWRkQ2xhc3MoXCJhY2NvLWl0ZW1fYWN0aXZlXCIpO1xyXG4gICAgXHJcbiAgfTtcclxuICBcclxuICBjb25zdCBjbG9zZUFjY28gPSAobGlzdCkgPT4ge1xyXG4gICAgY29uc3QgbGlzdEl0ZW0gPSBsaXN0LmZpbmQoXCIuYWNjby1pdGVtXCIpO1xyXG4gICAgbGlzdEl0ZW0ucmVtb3ZlQ2xhc3MoXCJhY2NvLWl0ZW1fYWN0aXZlXCIpO1xyXG4gIH07XHJcbiAgXHJcbiAgXHJcbiAgXHJcbiAgJChcIi5hY2NvLWl0ZW1cIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgbGV0ICR0aGlzID0gJChlLnRhcmdldCk7XHJcbiAgICBcclxuXHJcbiAgICBpZiAobWF4V2lkdGggPiA0ODApIHtcclxuICAgICAgaWYgKCQoZS50YXJnZXQpLmhhc0NsYXNzKFwiYWNjby10aXRsZS13cmFwcGVyXCIpIHx8ICQoZS50YXJnZXQpLmhhc0NsYXNzKFwiYWNjby10aXRsZVwiKSkge1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IGl0ZW1Db250YWluZXIgPSAkdGhpcy5jbG9zZXN0KFwiLmFjY28taXRlbVwiKTtcclxuICAgICAgICBjb25zdCBhY2NvTGlzdCA9IGl0ZW1Db250YWluZXIuY2xvc2VzdChcIi5hY2NvLWxpc3RcIik7XHJcbiAgICBcclxuICAgIFxyXG4gICAgICAgIGlmIChpdGVtQ29udGFpbmVyLmhhc0NsYXNzKFwiYWNjby1pdGVtX2FjdGl2ZVwiKSkge1xyXG4gICAgICAgICAgY2xvc2VBY2NvKGFjY29MaXN0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY2xvc2VBY2NvKGFjY29MaXN0KTtcclxuICAgICAgICAgIG9wZW5BY2NvKGl0ZW1Db250YWluZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgXHJcbiAgICAgIGlmICgkKGUudGFyZ2V0KS5oYXNDbGFzcyhcImNsb3NlLXhcIikgfHwgJChlLnRhcmdldCkuaGFzQ2xhc3MoXCJjbG9zZS12ZXJ0LW1lbnVcIikpIHtcclxuICAgICAgICBjb25zdCB0YXJnZXQgPSAkKGUudGFyZ2V0KTtcclxuICAgICAgICBjb25zdCBJdGVtcyA9IHRhcmdldC5jbG9zZXN0KFwiLmFjY28tbGlzdFwiKTtcclxuICAgIFxyXG4gICAgICAgIGNsb3NlQWNjbyhJdGVtcylcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsZXQgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbmNvbnNvbGUubG9nKCR0aGlzLmh0bWwoKSk7XHJcbiAgICAgIH1cclxuICAgIH0gXHJcbiAgICBcclxuICAgIFxyXG4gIFxyXG4gICAgXHJcbiAgfSk7XHJcbiAgXHJcbn0pKClcclxuXHJcbiIsIjsoZnVuY3Rpb24oKSB7XHJcbiAgY29uc3QgcGxheWVyID0gJChcIi5wbGF5ZXItZWxlbVwiKVswXTtcclxuICBjb25zdCBwbGF5ZXJDb250YWluZXIgPSAkKFwiLnBsYXllclwiKTtcclxuICBcclxuICAkKFwiLnBsYXktc3RvcFwiKS5jbGljaygoZSkgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIFxyXG4gICAgaWYgKHBsYXllckNvbnRhaW5lci5oYXNDbGFzcyhcInBsYXllcl9wYXVzZWRcIikpIHtcclxuICAgICAgcGxheWVyQ29udGFpbmVyLnJlbW92ZUNsYXNzKFwicGxheWVyX3BhdXNlZFwiKTtcclxuICAgICAgcGxheWVyQ29udGFpbmVyLnJlbW92ZUNsYXNzKFwicGxheWVyX2FjdGl2ZVwiKTtcclxuICAgICAgcGxheWVyLnBhdXNlKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBwbGF5ZXJDb250YWluZXIuYWRkQ2xhc3MoXCJwbGF5ZXJfcGF1c2VkXCIpO1xyXG4gICAgICBwbGF5ZXIucGxheSgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIFxyXG4gICQoXCIucGxheWJhY2tfX3NsaWRlci1saW5lXCIpLmNsaWNrKChlKSA9PiB7XHJcbiAgICBjb25zdCBsaW5lID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgY29uc3QgY2xpY2tlZFBvcyA9IGUub3JpZ2luYWxFdmVudC5sYXllclg7XHJcbiAgICBjb25zdCBuZXdCdG5Qb3NQcmVjZW50ID0gKGNsaWNrZWRQb3MgLyBsaW5lLndpZHRoKCkpICogMTAwO1xyXG4gIFxyXG4gICAgJChcIi5wbGF5YmFja19fYnRuXCIpLmNzcyh7XHJcbiAgICAgIGxlZnQ6IGAke25ld0J0blBvc1ByZWNlbnR9JWAsXHJcbiAgICB9KTtcclxuICBcclxuICAgIHBsYXllci5wYXVzZSgpO1xyXG4gICAgcGxheWVyLmN1cnJlbnRUaW1lID0gcGxheWVyLmR1cmF0aW9uICogKGNsaWNrZWRQb3MgLyBsaW5lLndpZHRoKCkpO1xyXG4gICAgcGxheWVyLnBsYXkoKTtcclxuICAgIHBsYXllckNvbnRhaW5lci5hZGRDbGFzcyhcInBsYXllcl9wYXVzZWRcIik7XHJcbiAgfSk7XHJcbiAgXHJcbiAgJChwbGF5ZXIpLm9uKFwidGltZXVwZGF0ZVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBsZXQgcGxheUJhY2tCdG4gPSAkKFwiLnBsYXliYWNrX19idG5cIik7XHJcbiAgICBsZXQgdGltZVByb2dyZXNzID0gKHBsYXllci5jdXJyZW50VGltZSAvIHBsYXllci5kdXJhdGlvbikgKiAxMDAgKyBcIiVcIjtcclxuICAgIHBsYXlCYWNrQnRuLmNzcyhcImxlZnRcIiwgdGltZVByb2dyZXNzKTtcclxuICB9KTtcclxuICBcclxuICAkKFwiLnZvbHVtZV9fc2xpZGVyLWxpbmVcIikuY2xpY2soKGUpID0+IHtcclxuICAgIGNvbnN0IHZvbHVtZUxpbmUgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICBjb25zdCB2b2x1bWVDbGlja2VkUG9zID0gZS5vcmlnaW5hbEV2ZW50LmxheWVyWDtcclxuICBcclxuICAgIGNvbnN0IHZvbEJ0blBvc1ByZWNlbnQgPSAodm9sdW1lQ2xpY2tlZFBvcyAvIHZvbHVtZUxpbmUud2lkdGgoKSkgKiAxMDA7XHJcbiAgXHJcbiAgICAkKFwiLnZvbHVtZV9fc2xpZGVyLWJ0blwiKS5jc3Moe1xyXG4gICAgICBsZWZ0OiBgJHt2b2xCdG5Qb3NQcmVjZW50fSVgLFxyXG4gICAgfSk7XHJcbiAgICBwbGF5ZXIudm9sdW1lID0gdm9sQnRuUG9zUHJlY2VudCAvIDEwMDtcclxuICBcclxuICAgIGlmIChwbGF5ZXJDb250YWluZXIuaGFzQ2xhc3MoXCJwbGF5ZXJfX3NvdW5kLW9mZlwiKSkge1xyXG4gICAgICBwbGF5ZXJDb250YWluZXIucmVtb3ZlQ2xhc3MoXCJwbGF5ZXJfX3NvdW5kLW9mZlwiKTtcclxuICAgICAgcGxheWVyLm11dGVkID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgXHJcbiAgJChcIi5wbGF5ZXItZWxlbVwiKS5vbihcInBsYXlcIiwgKGUpID0+IHtcclxuICAgIHBsYXllckNvbnRhaW5lci5hZGRDbGFzcyhcInBsYXllcl9hY3RpdmUgXCIpO1xyXG4gIH0pO1xyXG4gIFxyXG4gICQoXCIucGxheWVyLXNwbGFzaFwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XHJcbiAgICBwbGF5ZXJDb250YWluZXIuYWRkQ2xhc3MoXCJwbGF5ZXJfYWN0aXZlIHBsYXllcl9wYXVzZWRcIik7XHJcbiAgICBwbGF5ZXIucGxheSgpO1xyXG4gIH0pO1xyXG4gIFxyXG4gICQoXCIudm9sdW1lX19pY29ucy13cmFwcGVyXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcclxuICAgIGlmIChwbGF5ZXJDb250YWluZXIuaGFzQ2xhc3MoXCJwbGF5ZXJfX3NvdW5kLW9mZlwiKSkge1xyXG4gICAgICBwbGF5ZXJDb250YWluZXIucmVtb3ZlQ2xhc3MoXCJwbGF5ZXJfX3NvdW5kLW9mZlwiKTtcclxuICAgICAgcGxheWVyLm11dGVkID0gZmFsc2U7XHJcbiAgICB9IGVsc2UgaWYgKCQoZS50YXJnZXQpLmZpbHRlcihcImNsb3NlXCIpKSB7XHJcbiAgICAgIHBsYXllckNvbnRhaW5lci5hZGRDbGFzcyhcInBsYXllcl9fc291bmQtb2ZmXCIpO1xyXG4gICAgICBwbGF5ZXIubXV0ZWQgPSB0cnVlO1xyXG4gICAgfVxyXG4gIFxyXG4gIH0pO1xyXG4gIFxyXG59KSgpXHJcblxyXG5cclxuXHJcbiJdfQ==
